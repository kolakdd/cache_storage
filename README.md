# cache_storage

Веб сервер для хранения файлов со следующим функционалом:

1. Регистрация пользователя 
2. Аутентификация 
3. Загрузка нового документа 
4. Получение списка документов
5. Получение одного документа
6. Удаление документа
7. Завершение авторизованной сессии работы


При загрузке файла в поле grant необходимо записывать самого себя в том числе для получения прав на документ.

При использовании фильтра в получении списка файлов ключем является поле в базе данных (точное совпадение), а значением - точное значение поля в базе.

Хранения файлов в облачном хранилище S3, для более удобного масштабирования системы. В связи с этим поле data в соответствующих запросах имеет ссылку на скачивание с s3.

Брокер rabbitmq передачи сообщений для асинхронного загрузчика файлов. Которые изначально загружаются в директорию. (Для этого у объекта в БД есть флаг upload_s3).

Redis для реализации хранения кеша и хранения токенов авторизации.
Кеш привязывается к запросу и создается только при успешной авторизации и при подверждении наличия доступа. Инвалидация кеша происходит при:
1. загрузке нового файла - инвалидируются все ответы на получение списка документов
2. удалении файла - инвалидируются только ответы на получения одиночного, конкретного документа (который собственно был удален)

Для запросов с GET методами реализованы HEAD вариации с сохранением хедеров (в том числе Content-Length).

Для запуска проекта через докер, с настройками по умолчанию используйте:
```
docker compose up -d
```


Сервер доступен по порту :8090

В папке postman имеется актуальная коллекция с примерами запросов в формате postman v2.1 json.

token авторизации передается в хедерах запросов (кроме случаев описанных по заданию)



# for develop 

для поднятия сервисов
```
docker compose -f docker-compose-dev.yml up -d 
```

Сборка
```
docker compose build --no-cache
docker compose up -d
```

Разборка 
```
docker compose down -v --rmi all
docker builder prune
```
